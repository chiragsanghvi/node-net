"bind"in Function.prototype||(Function.prototype.bind=function(c){var f=this;if(1>=arguments.length)return function(){return f.apply(c,arguments)};var b=Array.prototype.slice.call(arguments,1);return function(){return f.apply(c,0===arguments.length?b:b.concat(Array.prototype.slice.call(arguments)))}});"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});
"indexOf"in Array.prototype||(Array.prototype.indexOf=function(c,f){void 0===f&&(f=0);0>f&&(f+=this.length);0>f&&(f=0);for(var b=this.length;f<b;f++)if(f in this&&this[f]===c)return f;return-1});"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(c,f){void 0===f&&(f=this.length-1);0>f&&(f+=this.length);f>this.length-1&&(f=this.length-1);for(f++;0<f--;)if(f in this&&this[f]===c)return f;return-1});
"forEach"in Array.prototype||(Array.prototype.forEach=function(c,f){for(var b=0,h=this.length;b<h;b++)b in this&&c.call(f,this[b],b,this)});"map"in Array.prototype||(Array.prototype.map=function(c,f){for(var b=Array(this.length),h=0,e=this.length;h<e;h++)h in this&&(b[h]=c.call(f,this[h],h,this));return b});"filter"in Array.prototype||(Array.prototype.filter=function(c,f){for(var b=[],h,e=0,g=this.length;e<g;e++)e in this&&c.call(f,h=this[e],e,this)&&b.push(h);return b});
"every"in Array.prototype||(Array.prototype.every=function(c,f){for(var b=0,h=this.length;b<h;b++)if(b in this&&!c.call(f,this[b],b,this))return!1;return!0});"some"in Array.prototype||(Array.prototype.some=function(c,f){for(var b=0,h=this.length;b<h;b++)if(b in this&&c.call(f,this[b],b,this))return!0;return!1});
Date.prototype.toISOString||function(){function c(c){c=String(c);1===c.length&&(c="0"+c);return c}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}();
String.addSlashes=function(c){if(!c)return c;c=c.replace(/\\/g,"\\\\");c=c.replace(/\'/g,"\\'");c=c.replace(/\"/g,'\\"');return c=c.replace(/\0/g,"\\0")};String.stripSlashes=function(c){if(!c)return c;c=c.replace(/\\'/g,"'");c=c.replace(/\\"/g,'"');c=c.replace(/\\0/g,"\x00");return c=c.replace(/\\\\/g,"\\")};
for(var _type=function(c){if(null===c)return"null";if(c&&(1===c.nodeType||9===c.nodeType))return"element";var f=Object.prototype.toString.call(c).match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===f){if(isNaN(c))return"nan";if(!isFinite(c))return"infinity"}return f},types="Null Undefined Object Array String Number Boolean Function RegExp Element NaN Infinite".split(" "),generateMethod=function(c){_type["is"+c]=function(f){return _type(f)===c.toLowerCase()}},i=0;i<types.length;i++)generateMethod(types[i]);
_type.isNullOrUndefined=function(c){return"null"==_type(c)||"undefined"==_type(c)};_type.isNumeric=function(c){return!isNaN(parseFloat(c))&&isFinite(c)};var global={};
(function(){global="undefined"===typeof window?process:window;global.Appacitive||(global.Appacitive={runtime:{isNode:"undefined"!=typeof process,isBrowser:"undefined"!=typeof window}});var c=function(b){if(b&&b.send&&_type.isFunction(b.send))b.onResponse=this.onResponse;else throw Error("No applicable httpTransport class found");var e=[],c={},g=0,h={},f=0;this.addProcessor=function(b){b&&(b.pre=b.pre||function(){},b.post=b.post||function(){},r(b.pre),u(b.post))};var r=function(b){g+=1;c[g]=b;return g},
u=function(b){f+=1;h[f]=b;return f};this.enqueueRequest=function(b){e.push(b)};this.changeRequestForCors=function(b){var e={m:b.method.toUpperCase()};b.headers.forEach(function(b){e[b.key]=b.value});b.prevHeaders=b.headers;b.headers=[];b.headers.push({key:"Content-Type",value:"text/plain"});b.method="POST";b.data&&(e.b=b.data);delete b.data;global.Appacitive.config.debug&&(-1===b.url.indexOf("?")?b.url+="?debug=true":b.url+="&debug=true");try{b.data=JSON.stringify(e)}catch(c){}return b};this.notify=
function(){if(0!==e.length){var g=[],f;for(f in h)h.hasOwnProperty(f)&&g.push(h[f]);for(;0<e.length;){var m=e.shift(),q=[];for(f in c)c.hasOwnProperty(f)&&q.push(c[f](m));this.changeRequestForCors(m);b.send(m,g,q)}}};this.onResponse=function(b){console.dir(b)}},f=function(){var b=function(){throw Error("Not Implemented Exception");};this.inOnline=this.send=b;this.onResponse=function(e,c){b()};this.onError=function(e){b()}},b=null,b=global.Appacitive.runtime.isBrowser?XMLHttpRequest:require("xmlhttprequest-with-globalagent").XMLHttpRequest,
h=function(b){var e=global.Appacitive.Promise.buildPromise({success:b.onSuccess,error:b.onError}),c=new XDomainRequest;c.onload=function(){var b=c.responseText;try{var g=c.contentType;if("application/json"==g.toLowerCase()||"application/javascript"==g.toLowerCase()||"application/json; charset=utf-8"==g.toLowerCase()||"application/json; charset=utf-8;"==g.toLowerCase())g=b,global.Appacitive.runtime.isBrowser||"{"!=g[0]&&(g=g.substr(1,g.length-1)),b=JSON.parse(g)}catch(h){}e.fulfill(b,this)};c.onerror=
c.ontimeout=function(){e.reject(c)};c.onprogress=function(){};-1===b.url.indexOf("?")?b.url+="?ua=ie":b.url+="&ua=ie";c.open(b.method,b.url,!0);c.send(b.data);return e},e=function(e){if(!e.url)throw Error("Please specify request url");e.method||(e.method="GET");e.headers||(e.headers=[]);var c={},g=global.Appacitive.Promise.buildPromise({success:e.onSuccess,error:e.onError}),f=!0;e.headers.forEach(function(b){"content-type"==b.key.toLowerCase()&&(f=!0,"application/json"==b.value.toLowerCase()||"application/javascript"==
b.value.toLowerCase()||"application/json; charset=utf-8"==b.value.toLowerCase()||"application/json; charset=utf-8;"==b.value.toLowerCase())&&(f=!1)});if(f)c=e.data;else if(e.data&&(c=e.data,_type.isObject(e.data)))try{c=JSON.stringify(c)}catch(n){}e.onSuccess&&_type.isFunction(e.onSuccess)||(e.onSuccess=function(){});e.onError&&_type.isFunction(e.onError)||(e.onError=function(){});if(!global.navigator||-1==global.navigator.userAgent.indexOf("MSIE 8")&&-1==global.navigator.userAgent.indexOf("MSIE 9")){var q=
new b;q.onreadystatechange=function(){if(4==this.readyState)if(200<=this.status&&300>this.status||304==this.status){var b=this.responseText;try{var e=this.getResponseHeader("content-type")||this.getResponseHeader("Content-Type");if("application/json"==e.toLowerCase()||"application/javascript"==e.toLowerCase()||"application/json; charset=utf-8"==e.toLowerCase()||"application/json; charset=utf-8;"==e.toLowerCase())e=b,global.Appacitive.runtime.isBrowser||"{"!=e[0]&&(e=e.substr(1,e.length-1)),b=JSON.parse(e)}catch(c){}g.fulfill(b,
this)}else g.reject(this)};q.open(e.method,e.url,!0);for(var r=0;r<e.headers.length;r+=1)q.setRequestHeader(e.headers[r].key,e.headers[r].value);global.Appacitive.runtime.isBrowser||q.setRequestHeader("User-Agent","Appacitive-NodeJSSDK");q.send(c);return g}e.data=c;return new h(e)},g=function(){var b=new f;b.isOnline=function(){return!0};var c=function(c,g,h){new e({method:c.method,url:c.url,headers:c.headers,data:c.data,onSuccess:function(e,k){if(e){try{e=JSON.parse(e)}catch(f){}var t=e;if(g.length!=
h.length)throw Error("Callback length and state length mismatch!");for(var v=0;v<g.length;v+=1)g[v].apply({},[t,h[v]]);if("200"<=e.code&&"300">=e.code||e.status&&"200"<=e.status.code&&"300">=e.status.code)b.onResponse(c,e);else e=e||{},e=e.status||e,e.message=e.message||"Bad Request",e.code=e.code||"400",b.onError(c,{responseText:JSON.stringify(e)})}else b.onError(c,{responseText:JSON.stringify({code:"400",message:"Invalid request"})})},onError:function(e){b.onError(c,e)}})};b.send=function(b,e,g){if(!global.Appacitive.Session.initialized)throw Error("Initialize Appacitive SDK");
_type.isFunction(b.beforeSend)&&b.beforeSend(b);c(b,e,g)};return b};global.Appacitive.http=new function(){var b=new g,e=new c(b),h=!1;this.pause=function(){h=!0};this.unpause=function(){h=!1};this.addProcessor=function(b){var c=Error('Must provide a processor object with either a "pre" function or a "post" function.');if(!b)throw c;if(!b.pre&&!b.post)throw c;e.addProcessor(b)};this.send=function(c){c.promise=global.Appacitive.Promise.is(c.promise)?c.promise:new global.Appacitive.Promise.buildPromise({error:c.onError});
e.enqueueRequest(c);b.isOnline()&&!1===h&&e.notify();return c.promise};this.flush=function(c){c?e.notify():b.isOnline()&&e.notify()};this.onError=function(b,e){var c;if(e&&e.responseText)try{var g=JSON.parse(e.responseText);g&&(c={code:g.code,error:g.message})}catch(h){}c=c||{code:e.status,message:e.responseText};global.Appacitive.logs.logRequest(b,c,c,"error");b.promise.reject(c,b.entity)};b.onError=this.onError;this.onResponse=function(b,e){if(b.onSuccess)if(b.context)b.onSuccess.apply(b.context,
[e]);else b.onSuccess(e);global.Appacitive.logs.logRequest(b,e,e?e.status:null,"successful")};b.onResponse=this.onResponse};global.Appacitive.HttpRequest=function(b){b=b||{};this.url=b.url||"";this.data=b.data||{};this.headers=b.headers||[];this.method=b.method||"GET";this.onSuccess=b.onSuccess||function(){};this.onError=b.onError||function(){};this.send=function(b){return new e(this,b)}};(function(b){b.Appacitive&&b.Appacitive.http&&(b.Appacitive.http.addProcessor({pre:function(b){return b},post:function(e,
c){try{var g=b.Appacitive.Session.isSessionValid(e);g.status?e&&(e.status&&e.status.code&&"19036"==e.status.code||e.code&&"19036"==e.code)?b.Appacitive.Users.logout():b.Appacitive.Session.incrementExpiry():g.isSession&&(null!==b.Appacitive.Session.get()&&b.Appacitive.Session.resetSession(),b.Appacitive.http.send(c))}catch(h){}}}),b.Appacitive.http.addProcessor({pre:function(b){return{start:(new Date).getTime(),request:b}},post:function(b,e){e.request.timeTakenInMilliseconds=(new Date).getTime()-e.start}}))})(global)})(this);
(function(c){c.Appacitive.logs=[];c.Appacitive.logs.errors=[];c.Appacitive.logs.exceptions=[];c.Appacitive.logs.logRequest=function(b,h,e,g){if(c.Appacitive.log){h=h||{};e=e||{};var f=JSON.parse(b.data),k={status:g,referenceId:e.referenceid,date:(new Date).toISOString(),method:f.m,url:b.url,responseTime:b.timeTakenInMilliseconds,headers:{},request:null,response:h};b.headers&&b.headers.forEach(function(b){k.headers[b.key]=b.value});b.prevHeaders&&b.prevHeaders.forEach(function(b){k.headers[b.key]=
b.value});"GET"!==k.method&&(k.request=f.b);"error"==g&&(console.dir(k),this.errors.push(k));this.push(k)}};var f=function(b,c){var e=[];b.forEach(function(b){b.method==c&&e.push(b)});return e};c.Appacitive.logs.getPutLogs=function(){return f(this,"PUT")};c.Appacitive.logs.getGetLogs=function(){return f(this,"GET")};c.Appacitive.logs.getPostLogs=function(){return f(this,"POST")};c.Appacitive.logs.getDeleteLogs=function(){return f(this,"DELETE")}})(global);
(function(c){String.format=function(c,b){if(1>=arguments.length)return c;for(var h=arguments.length-2,e=0;e<=h;e++)c=c.replace(RegExp("\\{"+e+"\\}","gi"),arguments[e+1]);return c};String.prototype.toPascalCase=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trimChar=function(c){var b=RegExp("^"+c),h=this;b.test(h)&&(h=h.slice(1,h.length));b=RegExp(c+"$");b.test(h)&&(h=h.slice(0,-1));return h};String.toSearchString=function(c){"undefined"===typeof c&&(c="");for(var b=
"",h=0;h<c.length;h+=1)-1===" .,;#".indexOf(c[h])&&(b+=c[h]);return b=b.toLowerCase()};String.contains=function(c,b){return-1!==c.indexOf(b)};String.startsWith=function(c,b){return 0===c.indexOf(b)};Array.distinct=function(c){var b=[],h=c.length,e,g,l;for(g=0;g<h;g++){e=void 0;for(l=0;l<b.length;l++)if(c[g].toLowerCase()===b[l].toLowerCase()){e=!0;break}e||b.push(c[g])}return b};Object.isEmpty=function(c){if(!c)return!0;var b=!0,h;for(h in c){b=!1;break}return b};c.dateFromWcf=function(c,b){var h=
/Date\(([^)]+)\)/.exec(c);if(2!=h.length){if(!b)return s;throw Error(s+" is not .net json date.");}return new Date(parseFloat(h[1]))};c.Appacitive.storage=c.Appacitive.storage||{};c.Appacitive.storage.urlFactory=new function(){c.Appacitive.bag=c.Appacitive.bag||{};var f=function(b){"object"===typeof b&&(0<b.length&&("string"===typeof b[0]||"number"===typeof b[0]))&&(b=b.join(","));b||(b="");return b};this.application={applicationServiceUrl:"application",getSessionCreateUrl:function(){return String.format("{0}/session",
this.applicationServiceUrl)}};this.email={emailServiceUrl:"email",getSendEmailUrl:function(){return String.format("{0}/send",this.emailServiceUrl)}};this.user={userServiceUrl:"user",getCreateUrl:function(b,c){return String.format("{0}/create?fields={1}",this.userServiceUrl,f(c))},getAuthenticateUserUrl:function(){return String.format("{0}/authenticate",this.userServiceUrl)},getGetUrl:function(b,c,e){return String.format("{0}/{1}?fields={2}",b,c,f(e))},getUserByTokenUrl:function(b){return String.format("{0}/me?useridtype=token&token={1}",
this.userServiceUrl,b)},getUserByUsernameUrl:function(b){return String.format("{0}/{1}?useridtype=username",this.userServiceUrl,b)},getUpdateUrl:function(b,c,e){return e?String.format("{0}/{1}?fields={2}&revision={3}",this.userServiceUrl,b,f(c),e):String.format("{0}/{1}?fields={2}",this.userServiceUrl,b,f(c))},getDeleteUrl:function(b,c,e){return!0===e?String.format("{0}/{1}?deleteconnections=true",this.userServiceUrl,c):String.format("{0}/{1}",this.userServiceUrl,c)},getGetAllLinkedAccountsUrl:function(b){return String.format("{0}/{1}/linkedaccounts",
this.userServiceUrl,b)},getValidateTokenUrl:function(b){return String.format("{0}/validate?userToken={1}",this.userServiceUrl,b)},getInvalidateTokenUrl:function(b){return String.format("{0}/invalidate?userToken={1}",this.userServiceUrl,b)},getSendResetPasswordEmailUrl:function(){return String.format("{0}/sendresetpasswordemail",this.userServiceUrl)},getUpdatePasswordUrl:function(b){return String.format("{0}/{1}/changepassword",this.userServiceUrl,b)},getLinkAccountUrl:function(b){return String.format("{0}/{1}/link",
this.userServiceUrl,b)},getDelinkAccountUrl:function(b,c){return String.format("{0}/{1}/{2}/delink",this.userServiceUrl,b,c)},getCheckinUrl:function(b,c,e){return String.format("{0}/{1}/chekin?lat={2}&lng={3}",this.userServiceUrl,b,c,e)},getResetPasswordUrl:function(b){return String.format("{0}/resetpassword?token={1}",this.userServiceUrl,b)},getValidateResetPasswordUrl:function(b){return String.format("{0}/validateresetpasswordtoken?token={1}",this.userServiceUrl,b)}};this.device={deviceServiceUrl:"device",
getCreateUrl:function(b,c){return String.format("{0}/register?fields={1}",this.deviceServiceUrl,f(c))},getGetUrl:function(b,c,e){return String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,c,f(e))},getUpdateUrl:function(b,c,e){return e?String.format("{0}/{1}?fields={2}&revision={3}",this.deviceServiceUrl,b,f(c),e):String.format("{0}/{1}?fields={2}",this.deviceServiceUrl,b,f(c))},getDeleteUrl:function(b,c,e){return!0===e?String.format("{0}/{1}?deleteconnections=true",this.deviceServiceUrl,c):String.format("{0}/{1}",
this.deviceServiceUrl,c)}};this.article={articleServiceUrl:"article",getSearchAllUrl:function(b,c,e){var g="",g=String.format("{0}/search/{1}/all",this.articleServiceUrl,b),g=e?g+"?psize="+e:g+"?psize=10";if("undefined"!==typeof c&&0<c.length)for(b=0;b<c.length;b+=1)0!==c[b].trim().length&&(g=g+"&"+c[b]);return g},getProjectionQueryUrl:function(){return String.format("{0}/search/project",this.articleServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/search/{1}/all?properties={2}",
this.articleServiceUrl,b,c)},getMultiGetUrl:function(b,c,e){return String.format("{0}/{1}/multiGet/{2}?fields={3}",this.articleServiceUrl,b,c,f(e))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.articleServiceUrl,b,f(c))},getGetUrl:function(b,c,e){return String.format("{0}/{1}/{2}?fields={3}",this.articleServiceUrl,b,c,f(e))},getUpdateUrl:function(b,c,e,g){return g?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.articleServiceUrl,b,c,f(e),g):String.format("{0}/{1}/{2}?fields={3}",
this.articleServiceUrl,b,c,f(e))},getDeleteUrl:function(b,c,e){return!0===e?String.format("{0}/{1}/{2}?deleteconnections=true",this.articleServiceUrl,b,c):String.format("{0}/{1}/{2}",this.articleServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",this.articleServiceUrl,b)}};this.connection={connectionServiceUrl:"connection",getGetUrl:function(b,c,e){return String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,f(e))},getMultiGetUrl:function(b,c,e){return String.format("{0}/{1}/multiGet/{2}?fields={3}",
this.connectionServiceUrl,b,c,f(e))},getCreateUrl:function(b,c){return String.format("{0}/{1}?fields={2}",this.connectionServiceUrl,b,f(c))},getUpdateUrl:function(b,c,e,g){return g?String.format("{0}/{1}/{2}?fields={3}&revision={4}",this.connectionServiceUrl,b,c,f(e),g):String.format("{0}/{1}/{2}?fields={3}",this.connectionServiceUrl,b,c,f(e))},getDeleteUrl:function(b,c){return String.format("{0}/{1}/{2}",this.connectionServiceUrl,b,c)},getMultiDeleteUrl:function(b){return String.format("{0}/{1}/bulkdelete",
this.connectionServiceUrl,b)},getSearchByArticleUrl:function(b,c,e,g){var f="",f=String.format("{0}/{1}/find/all?label={2}&articleid={3}",this.connectionServiceUrl,b,e,c);if("undefined"!==typeof g&&0<g.length)for(b=0;b<g.length;b+=1)f=f+"&"+g[b];return f},getConnectedArticles:function(b,c,e){var g="",g=String.format("{0}/{1}/{2}/find",this.connectionServiceUrl,b,c);if(e&&e.length&&0<e.length)for(b=0;b<e.length;b+=1)g=0===b?g+("?"+e[b]):g+("&"+e[b]);return g},getInterconnectsUrl:function(){return String.format("{0}/interconnects",
this.connectionServiceUrl)},getPropertiesSearchUrl:function(b,c){return String.format("{0}/{1}/find/all?properties=",this.connectionServiceUrl,b,c)}};this.cannedList={cannedListServiceUrl:"list",getGetListItemsUrl:function(b){return String.format("{0}/list/{1}/contents",this.cannedListServiceUrl,b)}};this.push={pushServiceUrl:"push",getPushUrl:function(){return String.format("{0}/",this.pushServiceUrl)},getGetNotificationUrl:function(b){return String.format("{0}/notification/{1}",this.pushServiceUrl,
b)},getGetAllNotificationsUrl:function(b){return String.format("{0}/getAll?psize={1}&pnum={2}",this.pushServiceUrl,b.psize,b.pnum)}};this.file={fileServiceUrl:"file",getUploadUrl:function(b,c){return c&&0<c.length?String.format("{0}/uploadurl?contenttype={1}&expires=20&filename={2}",this.fileServiceUrl,escape(b),escape(c)):String.format("{0}/uploadurl?contenttype={1}&expires=20",this.fileServiceUrl,escape(b))},getUpdateUrl:function(b,c){return String.format("{0}/updateurl/{1}?contenttype={2}&expires=20",
this.fileServiceUrl,b,escape(c))},getDownloadUrl:function(b,c){return String.format("{0}/download/{1}?expires={2}",this.fileServiceUrl,b,c)},getDeleteUrl:function(b){return String.format("{0}/delete/{1}",this.fileServiceUrl,b)}};this.query={params:function(b){var c=[];return""===location.search||-1===location.search.indexOf("?")?c:b?(b=b.toLowerCase(),location.search.split("?")[1].split("&").forEach(function(e,g){var f=g.split("="),k=f[1];2<f.length&&f.forEach(function(b,c){0!==b&&1!==b&&(k=k+"="+
f[b])});f[0].toLowerCase()===b&&(c=[f[0],k])}),c):location.search.split("?")[1].split("=")}}}})(global);
(function(c){var f;f=c.Appacitive.runtime.isNode?process.nextTick:setTimeout;var b=function(){if(!(this instanceof b))return new b;this.calls=[]};b.prototype.isResolved=function(){return 1===this.state?!0:!1};b.prototype.isRejected=function(){return 2===this.state?!0:!1};b.prototype.isFulfilled=function(){return 1===this.state||2===this.state?!0:!1};b.prototype.done=function(){var h,e,g=this.state,f=this.value;if(!g)return this;for(;h=this.calls.shift();)if(e=h[0],"function"===typeof h[g]){try{f=
h[g].apply(e,this.value)}catch(k){c.Appacitive.log&&(c.Appacitive.logs.exceptions.push(k),console.log(JSON.stringify({name:k.name,message:k.message,stack:k.stack},null,2))),e.reject(k)}f instanceof b||b.is(f)?f.then(function(b){e.fulfill(b)},function(b){e.reject(b)}):1===g?e.fulfill(f):e.reject(f)}else 1===g?e.fulfill(f):e.reject(f)};b.prototype.fulfill=function(){if(this.state)return this;this.state=1;this.value=arguments;this.done();return this};b.prototype.resolve=b.prototype.fulfill;b.prototype.reject=
function(){if(this.state)return this;this.state=2;this.reason=this.value=arguments;this.done();return this};b.prototype.then=function(c,e){var g=this,l=new b;this.calls[this.calls.length]=[l,c,e];this.state&&f(function(){g.done()});return l};b.when=function(c){var e=[],g=[],l,k=0,p=new b;if(!c)return p.fulfill(e),p;var m=function(){k+=1;k==l&&(p.state||(0<g.length?p.reject(g,e):p.fulfill(e)))},n=function(k){var l=c[k];l instanceof b||l&&"function"===typeof l.then?f(function(){l.then(function(b){e[k]=
b;m()},function(b){g[k]=b;m()})}):f(function(){try{e[k]=l.call()}catch(b){g[k]=b}m()})};Array.isArray(c)||(c=[c]);l=c.length;for(var q=0;q<l;q+=1)n(q);return p};b.is=function(c){return c instanceof b?!0:!1};b.buildPromise=function(c){var e=new b;_type.isObject(c)&&e.then(c.success,c.error);return e};c.Appacitive.Promise=b})(global);
(function(c){c.Appacitive.eventManager=new function(){function c(){var b=function(){return Math.floor(65536*Math.random()).toString(16)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}var b={};this.subscribe=function(h,e){if("string"!=typeof h||"function"!=typeof e)throw Error("Incorrect subscription call");"undefined"==typeof b[h]&&(b[h]=[]);var g=c();b[h].push({callback:e,id:g});return g};this.unsubscribe=function(c){if(!c)return!1;var e=-1,g=null,f;for(f in b)for(var k=0;k<b[f].length;k+=
1)if(b[f][k].id==c){e=k;g=f;break}return-1!=e?(b[g].splice(e,1),!0):!1};this.fire=function(c,e,g){if("string"!=typeof c)throw Error("Incorrect fire call");if("undefined"==typeof g||null===g)g={};g.eventName=c;if("undefined"!=typeof b.all)for(var f=0;f<b.all.length;f+=1)b.all[f].callback(e,g);f=function(b,c,e){setTimeout(function(){b(c,e)},0)};if("undefined"!=typeof b[c])for(var k=0;k<b[c].length;k+=1)f(b[c][k].callback,e,g)};this.clearSubscriptions=function(c){if("string"!=typeof c)throw Error("Event Name must be string in EventManager.clearSubscriptions");
b[c]&&(b[c].length=0);return this};this.clearAndSubscribe=function(b,c){this.clearSubscriptions(b);this.subscribe(b,c)};this.dump=function(){console.dir(b)}}})(global);(function(c){c.Appacitive.config={apiBaseUrl:"https://apis.appacitive.com/"};"undefined"!=typeof XDomainRequest&&(c.Appacitive.config.apiBaseUrl=window.location.protocol+"//apis.appacitive.com/")})(global);
(function(c){var f=function(b){if(!b||!_type.isObject(b))throw Error("Please specify request options");this.promise=c.Appacitive.Promise.buildPromise(b.callbacks);var h=this.request=new c.Appacitive.HttpRequest,e;e=c.Appacitive.storage.urlFactory[b.type];e=c.Appacitive.config.apiBaseUrl+e[b.op].apply(e,b.args||[]);h.url=e;h.method=b.method||"get";h.data=b.data||{};h.onSuccess=b.onSuccess;h.onError=b.onError;h.promise=this.promise;b.entity&&(h.entity=b.entity);return this};f.prototype.send=function(){return c.Appacitive.http.send(this.request)};
c.Appacitive._Request=f})(global);
(function(c){c.Appacitive.Session=new function(){this.initialized=!1;var f=function(){this.apikey="";this.isnonsliding=!1;this.usagecount=-1;this.windowtime=240},b=null,h=null,e=null,g=!1;this.useApiKey=!0;this.onSessionCreated=function(){};this.recreate=function(b){return c.Appacitive.Session.create(b)};this.create=function(e){if(!this.initialized)throw Error("Intialize Appacitive SDK");var g=new f;g.apikey=h;var l=new c.Appacitive._Request({method:"PUT",type:"application",op:"getSessionCreateUrl",
callbacks:e,data:g,onSuccess:function(e){b=e.session.sessionkey;c.Appacitive.Session.useApiKey=!1;l.promise.fulfill(e);c.Appacitive.Session.onSessionCreated()}});return l.send()};c.Appacitive.http.addProcessor({pre:function(k){c.Appacitive.Session.useApiKey?k.headers.push({key:"ak",value:h}):k.headers.push({key:"as",value:b});!0===g&&(1==k.headers.filter(function(b){return"ut"==b.key}).length?k.headers.forEach(function(b){"ut"==b.key&&(b.value=e)}):k.headers.push({key:"ut",value:e}))}});this.setUserAuthHeader=
function(b,h,f){try{b&&(g=!0,e=b,f||(h||(h=60),-1==h&&(h=null),c.Appacitive.Cookie.setCookie("Appacitive-UserToken",b,h),c.Appacitive.Cookie.setCookie("Appacitive-UserTokenExpiry",h?h:-1,h)))}catch(l){}};this.incrementExpiry=function(){};this.removeUserAuthHeader=function(b){c.Appacitive.localStorage.remove("Appacitive-User");if(e&&b)try{var h=new c.Appacitive.Promise,f=new c.Appacitive.HttpRequest;f.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.user.getInvalidateTokenUrl(e);
f.method="POST";f.data={};f.onSuccess=f.onError=function(){g=!1;e=null;c.Appacitive.Cookie.eraseCookie("Appacitive-UserToken");c.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry");h.fulfill()};c.Appacitive.http.send(f);return h}catch(l){}else return g=!1,e=null,c.Appacitive.Cookie.eraseCookie("Appacitive-UserToken"),c.Appacitive.Cookie.eraseCookie("Appacitive-UserTokenExpiry"),c.Appacitive.Promise().fulfill()};this.isSessionValid=function(b){if(!b)return!0;if(b.status){if(b.status.code&&
("19027"==b.status.code||"19002"==b.status.code))return{status:!1,isSession:"19027"==b.status.code?!0:!1}}else if(b.code&&("19027"==b.code||"19002"==b.code))return{status:!1,isSession:"19027"==b.code?!0:!1};return{status:!0}};this.resetSession=function(){b=null;this.useApiKey=!0};this.get=function(){return b};this.setSession=function(c){c&&(b=c,this.useApiKey=!1)};this.setApiKey=function(b){b&&(h=b,this.useApiKey=!0)};var l="sandbox";this.environment=function(){if(1==arguments.length){var b=arguments[0];
"sandbox"!=b&&"live"!=b&&(b="sandbox");l=b}return l}};c.Appacitive.getAppPrefix=function(f){return c.Appacitive.Session.environment()+"/"+c.Appacitive.appId+"/"+f};c.Appacitive.initialize=function(f){f=f||{};if(!c.Appacitive.Session.initialized){if(!f.apikey||0===f.apikey.length)throw Error("apikey is mandatory");if(!f.appId||0===f.appId.length)throw Error("appId is mandatory");c.Appacitive.Session.setApiKey(f.apikey);c.Appacitive.Session.environment(f.env||"sandbox");c.Appacitive.useApiKey=!0;c.Appacitive.appId=
f.appId;c.Appacitive.Session.initialized=!0;c.Appacitive.Session.persistUserToken=f.persistUserToken;f.debug&&(c.Appacitive.config.debug=!0);f.log&&(c.Appacitive.log=[]);if(f.userToken)-1==f.expiry?f.expiry=null:f.expiry||(f.expiry=3600),c.Appacitive.Session.setUserAuthHeader(f.userToken,f.expiry),f.user?c.Appacitive.Users.setCurrentUser(f.user):(f=c.Appacitive.localStorage.get("Appacitive-User"))&&c.Appacitive.Users.setCurrentUser(f);else if(c.Appacitive.runtime.isBrowser){var b=c.Appacitive.Cookie.readCookie("Appacitive-UserToken");
if(b){var h=c.Appacitive.Cookie.readCookie("Appacitive-UserTokenExpiry");h||(h=60);(f=c.Appacitive.localStorage.get("Appacitive-User"))&&c.Appacitive.Users.setCurrentUser(f,b,h)}}}}})(global);(function(c){c.Appacitive&&c.Appacitive.http&&c.Appacitive.http.addProcessor({pre:function(f){f.headers.push({key:"e",value:c.Appacitive.Session.environment()})}})})(global);
(function(c){var f=c.Appacitive;f.GeoCoord=function(b,c){var e=function(b,c){if(isNaN(b)||isNaN(c))throw Error("Invalid Latitiude or longitiude provided");if(-90>b||90<b)throw Error("Latitude "+b+" should be in range of  -90.0 to 90.");if(-180>c||180<c)throw Error("Latitude "+c+" should be in range of  -180.0 to 180.");};b&&c?(e(b,c),this.lat=b,this.lng=c):this.lng=this.lat=0;this.toJSON=function(){return{latitude:this.lat,longitude:this.lng}};this.getValue=function(){return String.format("{0},{1}",
b,c)};this.toString=function(){return this.getValue()}};var b=function(){this.toString=function(){};this.Or=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new m(n.or,b)};this.And=function(){var b=Array.prototype.slice.call(arguments,0);b.splice(0,0,this);return new m(n.and,b)}},h=function(c){b.call(this);c=c||{};this.fieldType=c.fieldType;this.field=c.field||"";this.value=c.value;this.operator=c.operator;this.getFieldType=function(){switch(this.fieldType){case "property":return"*";
case "attribute":return"@";case "aggregate":return"$";default:return"*"}};this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,this.value.getValue())}};h.prototype=new b;h.prototype.constructor=h;var e=function(b){b=b||"";if(!_type.isArray(b.value)||!b.value.length)throw Error("Specify field value as array");h.call(this,b);this.toString=function(){for(var b=[],c=0;c<this.value.length;c+=1)b.push(String.format("{0}{1} {2} {3}",this.getFieldType(),
this.field.toLowerCase(),this.operator,_type.isString(this.value[c])?"'"+this.value[c]+"'":_type.isNumber(this.value[c])?this.value[c]:this.value[c].toString()));return"("+b.join(" or ")+")"}};e.prototype=new h;e.prototype.constructor=e;var g=function(b){b=b||"";if(!b.val1)throw Error("Specify field value1 ");if(!b.val2)throw Error("Specify field value2 ");this.val1=b.val1;this.val2=b.val2;h.call(this,b);delete this.value;this.toString=function(){return String.format("{0}{1} {2} ({3},{4})",this.getFieldType(),
this.field.toLowerCase(),this.operator,this.val1.getValue(),this.val2.getValue())}};g.prototype=new h;g.prototype.constructor=g;var l=function(b){b=b||"";if(!(b.geoCoord&&b.geoCoord instanceof f.GeoCoord))throw Error("withinCircle filter needs Appacitive.GeoCoord object as argument");h.call(this,b);this.value=b.geoCoord;this.unit=b.unit||"mi";this.distance=b.distance||5;this.toString=function(){return String.format("{0}{1} {2} {3},{4} {5}",this.getFieldType(),this.field.toLowerCase(),this.operator,
this.value.getValue(),this.distance,this.unit)}};l.prototype=new h;l.prototype.constructor=g;var k=function(b){b=b||"";if(!b.geoCoords||0===b.geoCoords.length)throw Error("polygon filter needs array of Appacitive.GeoCoord objects as argument");if(3>b.geoCoords.length)throw Error("polygon filter needs atleast 3 Appacitive.GeoCoord objects as arguments");h.call(this,b);this.value=b.geoCoords;var c=function(b){var c="";b.forEach(function(b){c=0===c.length?b.toString():c+(" | "+b.toString())});return c};
this.toString=function(){return String.format("{0}{1} {2} {3}",this.getFieldType(),this.field.toLowerCase(),this.operator,c(this.value))}};k.prototype=new h;k.prototype.constructor=g;var p=function(c){b.call(this);c=c||{};if(!c.tags||_type.isArray(c.tags)||0===c.tags.length)throw Error("Specify valid tags");this.tags=c.tags;this.operator=c.operator;this.toString=function(){return String.format("{0}('{1}')",this.operator,this.tags.join(","))}};p.prototype=new b;p.prototype.constructor=p;var m=function(c,
e){if(!e||!e.length||2>e.length)throw Error("Provide valid or atleast 2 filters");this.operator=c;this.innerFilters=[];for(var g=0;g<e.length;g+=1){if(!(e[g]instanceof b))throw Error("Invalid filter provided");this.innerFilters.push(e[g])}this.toString=function(){var b=this.operator,c="(";this.innerFilters.forEach(function(e){c=1===c.length?c+(" "+e.toString()):c+String.format(" {0} {1} ",b,e.toString())});return c+=")"}};m.prototype=new b;m.prototype.constructor=m;var n={isEqualTo:"==",isGreaterThan:">",
isGreaterThanEqualTo:">=",isLessThan:"<",isLessThanEqualTo:"<=",like:"like",match:"match",between:"between",withinCircle:"within_circle",withinPolygon:"within_polygon",or:"or",and:"and",taggedWithAll:"tagged_with_all",taggedWithOneOrMore:"tagged_with_one_or_more"},q=function(b,c){if(null===b||void 0===b||0===b.length)throw Error("Specify value");this.value=b;this.type=c?c:typeof this.value;if("number"===this.type&&!_type.isNumeric(this.value))throw Error("Value should be numeric for filter expression");
this.getValue=function(){return"string"===this.type?"'"+this.value+"'":"number"===this.type||_type.isBoolean(this.value)?this.value:"object"===this.type&&this.value instanceof date?"datetime('"+f.Date.toISOString(this.value)+"')":this.value.toString()}},r=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"date('"+f.Date.toISODate(this.value)+"')":"date('"+this.value+"')"}},u=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"time('"+
f.Date.toISOTime(this.value)+"')":"time('"+this.value+"')"}},t=function(b){this.value=b;this.getValue=function(){return this.value instanceof Date?"datetime('"+f.Date.toISOString(this.value)+"')":"datetime('"+this.value+"')"}},v=function(b,c,f){f||(f=this);f.type=b;f.name=c;f.equalTo=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b),operator:n.isEqualTo})};f.equalToNumber=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:n.isEqualTo})};
f.equalToDate=function(b){return new h({field:this.name,fieldType:this.type,value:new r(b),operator:n.isEqualTo})};f.equalToTime=function(b){return new h({field:this.name,fieldType:this.type,value:new u(b),operator:n.isEqualTo})};f.equalToDateTime=function(b){return new h({field:this.name,fieldType:this.type,value:new t(b),operator:n.isEqualTo})};f.greaterThan=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:n.isGreaterThan})};f.greaterThanDate=function(b){return new h({field:this.name,
fieldType:this.type,value:new r(b),operator:n.isGreaterThan})};f.greaterThanTime=function(b){return new h({field:this.name,fieldType:this.type,value:new u(b),operator:n.isGreaterThan})};f.greaterThanDateTime=function(b){return new h({field:this.name,fieldType:this.type,value:new t(b),operator:n.isGreaterThan})};f.greaterThanEqualTo=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:n.isGreaterThanEqualTo})};f.greaterThanEqualToDate=function(b){return new h({field:this.name,
fieldType:this.type,value:new r(b),operator:n.isGreaterThanEqualTo})};f.greaterThanEqualToTime=function(b){return new h({field:this.name,fieldType:this.type,value:new u(b),operator:n.isGreaterThanEqualTo})};f.greaterThanEqualToDateTime=function(b){return new h({field:this.name,fieldType:this.type,value:new t(b),operator:n.isGreaterThanEqualTo})};f.lessThan=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:n.isLessThan})};f.lessThanDate=function(b){return new h({field:this.name,
fieldType:this.type,value:new r(b),operator:n.isLessThan})};f.lessThanTime=function(b){return new h({field:this.name,fieldType:this.type,value:new u(b),operator:n.isLessThan})};f.lessThanDateTime=function(b){return new h({field:this.name,fieldType:this.type,value:new t(b),operator:n.isLessThan})};f.lessThanEqualTo=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b,"number"),operator:n.isLessThanEqualTo})};f.lessThanEqualToDate=function(b){return new h({field:this.name,fieldType:this.type,
value:new r(b),operator:n.isLessThanEqualTo})};f.lessThanEqualToTime=function(b){return new h({field:this.name,fieldType:this.type,value:new u(b),operator:n.isLessThanEqualTo})};f.lessThanEqualToDateTime=function(b){return new h({field:this.name,fieldType:this.type,value:new t(b),operator:n.isLessThanEqualTo})};f.like=function(b){return new h({field:this.name,fieldType:this.type,value:new q("*"+b+"*"),operator:n.like})};f.match=function(b){return new h({field:this.name,fieldType:this.type,value:new q("*"+
b+"*"),operator:n.match})};f.startsWith=function(b){return new h({field:this.name,fieldType:this.type,value:new q(b+"*"),operator:n.like})};f.endsWith=function(b){return new h({field:this.name,fieldType:this.type,value:new q("*"+b),operator:n.like})};f.contains=function(b){return new e({field:this.name,fieldType:this.type,value:b,operator:n.isEqualTo})};f.between=function(b,c){return new g({field:this.name,fieldType:this.type,val1:new q(b,"number"),val2:new q(c,"number"),operator:n.between})};f.betweenDate=
function(b,c){return new g({field:this.name,fieldType:this.type,val1:new r(b),val2:new r(c),operator:n.between})};f.betweenTime=function(b,c){return new g({field:this.name,fieldType:this.type,val1:new u(b),val2:new u(c),operator:n.between})};f.betweenDateTime=function(b,c){return new g({field:this.name,fieldType:this.type,val1:new t(b),val2:new t(c),operator:n.between})};f.withinCircle=function(b,c,e){return new l({field:this.name,fieldType:this.type,geoCoord:b,distance:c,unit:e,operator:n.withinCircle})};
f.withinPolygon=function(b){return new k({field:this.name,fieldType:this.type,geoCoords:b,operator:n.withinPolygon})}},x=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;v("property",b,this);return this},w=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var c=new v("aggregate",b);this.equalTo=function(b){return c.equalTo(b)};this.greaterThan=function(b){return c.greaterThan(b)};this.greaterThanEqualTo=function(b){return c.greaterThanEqualTo(b)};
this.lessThan=function(b){return c.lessThan(b)};this.lessThanEqualTo=function(b){return c.lessThanEqualTo(b)};this.between=function(b,e){return c.between(b,e)};return this},y=function(b){if(!b||0===b.length)throw Error("Specify field name");this.field=b;var c=new v("attribute",b);this.like=function(b){return c.like(b)};this.like=function(b){return c.match(b)};this.startWith=function(b){return c.startsWith(b)};this.endsWith=function(b){return c.endsWith(b)};this.equalTo=function(b){return c.equalTo(b)};
this.contains=function(b){return c.contains(b)};return this};f.Filter={Property:function(b){return new x(b)},Aggregate:function(b){return new w(b)},Attribute:function(b){return new y(b)},Or:function(){return new m(n.or,arguments)},And:function(){return new m(n.and,arguments)},taggedWithOneOrMore:function(b){return new p({tags:b,operator:n.taggedWithOneOrMore})},taggedWithAll:function(b){return new p({tags:b,operator:n.taggedWithAll})}}})(global);
(function(c){c.Appacitive.Queries={};var f=function(b){b=b||{};var c=1,f=20;this.pageNumber=function(){return 1==arguments.length?(c=arguments[0]||1,this):c};this.pageSize=function(){return 1==arguments.length?(f=arguments[0]||20,this):f};this.pageNumber(b.pageNumber);this.pageSize(b.pageSize)};f.prototype.toString=function(){return"psize="+this.pageSize()+"&pnum="+this.pageNumber()};var b=function(b){b=b||{};var c="__UtcLastUpdatedDate",f=!1;this.orderBy=function(){return 1===arguments.length?(c=
arguments[0]||"__UtcLastUpdatedDate",this):c};this.isAscending=function(){return 1===arguments.length?(f=void 0===arguments[0]||null==arguments[0]?!1:arguments[0],this):f};this.orderBy(b.orderBy);this.isAscending(b.isAscending)};b.prototype.toString=function(){return"orderBy="+this.orderBy()+"&isAsc="+this.isAscending()};var h=function(e){var g=e||{},h="",k="",p="",m=g.queryType||"BasicQuery",n=new f(e),q=new b(e),r=g.schema||g.relation,u=g.relation?"connection":"article",t=this;this.type=function(){return u};
this.entityType=function(){return r};this.queryType=function(){return m};this.pageQuery=function(){return n};this.pageNumber=function(){return 1===arguments.length?(n.pageNumber(arguments[0]),this):n.pageNumber()};this.pageSize=function(){return 1===arguments.length?(n.pageSize(arguments[0]),this):n.pageSize()};this.sortQuery=function(){return q};this.orderBy=function(){return 1===arguments.length?(q.orderBy(arguments[0]),this):q.orderBy()};this.isAscending=function(){return 1===arguments.length?
(q.isAscending(arguments[0]),this):q.isAscending()};this.filter=function(){return 1===arguments.length?(h=arguments[0],this):h};this.freeText=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?k=arguments[0]:_type.isArray(b)&&b.length&&(k=arguments[0].join(" "));return this}return k};this.fields=function(){if(1===arguments.length){var b=arguments[0];_type.isString(b)?p=b:_type.isArray(b)&&b.length&&(p=b.join(","));return this}return p};this.filter(g.filter||"");this.freeText(g.freeText||
"");this.fields(g.fields||"");this.setFilter=function(b){this.filter(b)};this.setFreeText=function(b){this.freeText(b)};this.setFields=function(b){this.fields(b)};this.extendOptions=function(c){for(var e in c)g[e]=c[e];n=new f(g);q=new b(g);return this};this.getQueryString=function(){var b=n.toString()+"&"+q.toString();if(this.filter()){var c=this.filter().toString();0<c.trim().length&&(b+="&query="+c)}this.freeText()&&0<this.freeText().trim().length&&(b+="&freetext="+this.freeText()+"&language=en");
this.fields()&&0<this.fields().trim().length&&(b+="&fields="+this.fields());return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+u+"/"+r+"/find/all?"+this.getQueryString()};this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.getOptions=function(){var b={},c;for(c in this)this.hasOwnProperty(c)&&!_type.isFunction(this[c])&&(b[c]=this[c]);return b};this._setPaging=function(b){b&&(n.pageNumber(b.pagenumber),n.pageSize(b.pagesize),
this.results=this.results||[],this.results.isLastPage=!1,this.results.total=b.totalrecords,this.results.pageNumber=b.pagenumber,this.results.pageSize=b.pagesize,b.pagenumber*b.pagesize>=b.totalrecords&&(this.results.isLastPage=!0))};var v=function(b){var e=[];b||(b=[]);var g="article"===u?"Article":"Connection";r&&"user"==r.toLowerCase()&&(g="User");b.forEach(function(b){e.push(new c.Appacitive[g](b,!0))});return e};this.fetch=function(b){var e=c.Appacitive.Promise.buildPromise(b);b=this.toRequest();
b.onSuccess=function(b){t.results=v(b[u+"s"]);t._setPaging(b.paginginfo);e.fulfill(t.results,b.paginginfo)};b.promise=e;b.entity=this;return c.Appacitive.http.send(b)};this.fetchNext=function(b){var c=this.pageNumber();this.pageNumber(++c);return this.fetch(b)};this.fetchPrev=function(b){var c=this.pageNumber(),c=c-1;0>=c&&(c=1);this.pageNumber(c);return this.fetch(b)};this.count=function(b){var e=c.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(b){b=b||{};b=b.paginginfo;
var c=0,c=b?b.totalrecords:0;e.fulfill(c)};b.promise=e;b.entity=this;return c.Appacitive.http.send(b)}};c.Appacitive.Queries.FindAllQuery=function(b){b=b||{};if(!b.schema&&!b.relation||b.schema&&b.relation)throw Error("Specify either schema or relation for basic filter query");b.queryType="BasicFilterQuery";h.call(this,b);return this};c.Appacitive.Queries.FindAllQuery.prototype=new h;c.Appacitive.Queries.FindAllQuery.prototype.constructor=c.Appacitive.Queries.FindAllQuery;c.Appacitive.Queries.ConnectedArticlesQuery=
function(b){b=b||{};if(!b.relation)throw Error("Specify relation for connected articles query");if(!b.articleId)throw Error("Specify articleId for connected articles query");if(!b.schema)throw Error("Specify schema of article id for connected articles query");var g=b.schema;delete b.schema;b.queryType="ConnectedArticlesQuery";h.call(this,b);this.articleId=b.articleId;this.relation=b.relation;this.schema=g;b.article instanceof c.Appacitive.Article&&(this.article=b.article);this.returnEdge=!0;void 0===
b.returnEdge||(null===b.returnEdge||b.returnEdge||this.prev)||(this.returnEdge=!1);this.label="";var f=this;_type.isString(b.label)&&0<b.label.length&&(this.label="&label="+b.label);this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"/"+this.schema+"/"+this.articleId+"/find?"+this.getQueryString()+this.label+"&returnEdge="+this.returnEdge};var k=function(b,
e){var g=[];b.forEach(function(b){var f=null;if(b.__edge){f=b.__edge;delete b.__edge;f.__endpointa=e;f.__endpointb={articleid:b.__id,label:f.__label,type:b.__schematype};delete f.label;var h=new c.Appacitive.Connection(f,!0),f=new c.Appacitive.Article(b,!0);f.connection=h}else f=new c.Appacitive.Article(b,!0);g.push(f)});f.article&&(f.article.children[f.relation]=g);return g};this.fetch=function(h){var m=c.Appacitive.Promise.buildPromise(h);h=this.toRequest();h.onSuccess=function(c){var h=k;f.prev&&
(h=prevParseNodes);f.results=h(c.nodes?c.nodes:[],{articleid:b.articleId,type:g,label:c.parent});f._setPaging(c.paginginfo);m.fulfill(f.results,c.paginginfo)};h.promise=m;h.entity=this;return c.Appacitive.http.send(h)};return this};c.Appacitive.Queries.ConnectedArticlesQuery.prototype=new h;c.Appacitive.Queries.ConnectedArticlesQuery.prototype.constructor=c.Appacitive.Queries.ConnectedArticlesQuery;c.Appacitive.Queries.GetConnectionsQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsQuery query");
if(!b.articleId)throw Error("Specify articleId for GetConnectionsQuery query");if(!b.label||0===b.label.trim().length)throw Error("Specify label for GetConnectionsQuery query");b.schema&&delete b.schema;b.queryType="GetConnectionsQuery";h.call(this,b);this.articleId=b.articleId;this.relation=b.relation;this.label=b.label;this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+
this.relation+"/find/all?"+this.getQueryString()+"&articleid="+this.articleId+"&label="+this.label};return this};c.Appacitive.Queries.GetConnectionsQuery.prototype=new h;c.Appacitive.Queries.GetConnectionsQuery.prototype.constructor=c.Appacitive.Queries.GetConnectionsQuery;c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery=function(b,g){b=b||{};if(!b.articleAId||!_type.isString(b.articleAId)||0===b.articleAId.length)throw Error("Specify valid articleAId for GetConnectionsBetweenArticlesQuery query");
if(!b.articleBId||!_type.isString(b.articleBId)||0===b.articleBId.length)throw Error("Specify articleBId for GetConnectionsBetweenArticlesQuery query");b.schema&&delete b.schema;b.queryType=g||"GetConnectionsBetweenArticlesQuery";h.call(this,b);this.articleAId=b.articleAId;this.articleBId=b.articleBId;this.label="GetConnectionsBetweenArticlesForRelationQuery"===this.queryType()&&b.label&&_type.isString(b.label)&&0<b.label.length?"&label="+b.label:"";this.relation=b.relation&&_type.isString(b.relation)&&
0<b.relation.length?b.relation+"/":"";this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="get";return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/"+this.relation+"find/"+this.articleAId+"/"+this.articleBId+"?"+this.getQueryString()+this.label};return this};c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype=new h;c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery.prototype.constructor=c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery;
c.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery=function(b){b=b||{};if(!b.relation)throw Error("Specify relation for GetConnectionsBetweenArticlesForRelationQuery query");b=new c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b,"GetConnectionsBetweenArticlesForRelationQuery");b.fetch=function(b){var e=c.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(b){e.fulfill(b.connection?new c.Appacitive.Connection(b.connection,!0):null)};b.promise=e;b.entity=
this;return c.Appacitive.http.send(b)};return b};c.Appacitive.Queries.InterconnectsQuery=function(b){b=b||{};if(!b.articleAId||!_type.isString(b.articleAId)||0===b.articleAId.length)throw Error("Specify valid articleAId for InterconnectsQuery query");if(!(b.articleBIds&&_type.isArray(b.articleBIds)&&0<b.articleBIds.length))throw Error("Specify list of articleBIds for InterconnectsQuery query");b.schema&&delete b.schema;b.queryType="InterconnectsQuery";h.call(this,b);this.articleAId=b.articleAId;this.articleBIds=
b.articleBIds;this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data={article1id:this.articleAId,article2ids:this.articleBIds};return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"connection/interconnects?"+this.getQueryString()};return this};c.Appacitive.Queries.InterconnectsQuery.prototype=new h;c.Appacitive.Queries.InterconnectsQuery.prototype.constructor=c.Appacitive.Queries.InterconnectsQuery;c.Appacitive.Queries.GraphFilterQuery=
function(b,g){if(!b||0===b.length)throw Error("Specify name of filter query");this.name=b;this.data={};this.queryType="GraphFilterQuery";if(g){this.data.placeholders=g;for(var f in this.data.placeholders)this.data.placeholders[f]=this.data.placeholders[f]}this.toRequest=function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data=this.data;return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"search/"+this.name+"/filter"};this.fetch=function(b){var e=c.Appacitive.Promise.buildPromise(b);
b=this.toRequest();b.onSuccess=function(b){e.fulfill(b.ids?b.ids:[])};b.promise=e;b.entity=this;return c.Appacitive.http.send(b)}};c.Appacitive.Queries.GraphProjectQuery=function(b,g,f){if(!b||0===b.length)throw Error("Specify name of project query");if(!g||!g.length)throw Error("Specify ids to project");this.name=b;this.data={ids:g};this.queryType="GraphProjectQuery";if(f){this.data.placeholders=f;for(var h in this.data.placeholders)this.data.placeholders[h]=this.data.placeholders[h]}this.toRequest=
function(){var b=new c.Appacitive.HttpRequest;b.url=this.toUrl();b.method="post";b.data=this.data;return b};this.toUrl=function(){return c.Appacitive.config.apiBaseUrl+"search/"+this.name+"/project"};var p=function(b){var e,g;for(g in b)if("status"!==g){e=b[g];break}var f=function(b,e,g){var h=[];b.forEach(function(b){var k=b.__children;delete b.__children;var l=b.__edge;delete b.__edge;b=new c.Appacitive.Article(b,!0);b.children={};for(var p in k)b.children[p]=[],b.children[p]=f(k[p].values,k[p].parent,
b.id);l&&(l.__endpointa={articleid:g,label:e},l.__endpointb={articleid:b.id(),label:l.__label},delete l.__label,b.connection=new c.Appacitive.Connection(l,!0));h.push(b)});return h};return f(e.values)};this.fetch=function(b){var e=c.Appacitive.Promise.buildPromise(b);b=this.toRequest();b.onSuccess=function(b){e.fulfill(p(b))};b.promise=e;b.entity=this;return c.Appacitive.http.send(b)}}})(global);
(function(c){c.Appacitive.BaseObject=function(f,b){var h={},e=function(b,e){for(var g in b)if(_type.isString(b[g]))e[g]=b[g];else if(b[g]instanceof Date)e[g]=c.Appacitive.Date.toISOString(b[g]);else if(_type.isObject(b[g])){e[g]||(e[g]={});for(var f in b[g])e[g][f]=b[g][f]}else if(_type.isArray(b[g])){if(e[g]=[],b[g].forEach(function(b){if(_type.isString(b))e[g].push(b);else if(_type.isNumber(b)||_type.isBoolean(b))e[g].push(value+"");else if(b instanceof Date)e[g].push(c.Appacitive.Date.toISOString(b));
else if("__link"==g)e[g].push(b);else throw Error("Multivalued property cannot have values of property as an object");}),"__tags"!==g||"__link"!==g)e[g].push=function(b){var e=this.length;if(_type.isString(b))this[e]=b;else if(_type.isNumber(b)||_type.isBoolean(b))this[e]=b+"";else if(b instanceof Date)this[e]=c.Appacitive.Date.toISOString(b);else throw Error("Multivalued property cannot have values of property as an object");return this}}else e[g]=b[g]},g=this,l={};e(f,l);var k=l;b&&e(k,h);!h.__id&&
l.__id&&(h.__id=l.__id);l.__schematype?(l.__schematype=l.__schematype.toLowerCase(),this.schema=this.entityType=l.__schematype,this.type="user"==l.__schematype||"device"==l.__schematype?l.__schematype:"article"):l.__relationtype&&(l.__relationtype=l.__relationtype.toLowerCase(),this.relation=this.entityType=l.__relationtype,this.type="connection");this.cid=parseInt(1E6*Math.random(),10);k.__attributes||(k.__attributes={});h.__attributes||(h.__attributes={});var p=[],m=[];k.__tags||(k.__tags=[]);h.__tags||
(h.__tags=[]);var n="",q="__id __revision __endpointa __endpointb __createdby __lastmodifiedby __schematype __relationtype __schemaid __relationid __utcdatecreated __utclastupdateddate __tags __authType __link".split(" "),r=["__link","__endpointa","__endpointb"],u=function(b){b=b||{};b.message=b.message||"Server error";b.code=b.code||"500";return b};this.attributes=this.toJSON=this.getObject=function(){return JSON.parse(JSON.stringify(k))};this.properties=function(){var b=this.attributes();delete b.__attributes;
delete b.__tags;return b};this.id=function(){return 1===arguments.length?(this.set("__id",arguments[0]),this):this.get("__id")};this.attr=function(){if(0===arguments.length)k.__attributes||(k.__attributes={});else{if(1===arguments.length)return k.__attributes||(k.__attributes={}),k.__attributes[arguments[0]];if(2===arguments.length){if(!_type.isString(arguments[1])&&null!==arguments[1])throw Error("only string values can be stored in attributes.");k.__attributes||(k.__attributes={});k.__attributes[arguments[0]]=
arguments[1]}else throw Error(".attr() called with an incorrect number of arguments. 0, 1, 2 are supported.");}return k.__attributes};var t=function(){if(!k.__attributes)return null;var b=!1,c=JSON.parse(JSON.stringify(h.__attributes)),e;for(e in k.__attributes)null==k.__attributes[e]||void 0==k.__attributes[e]?(c[e]=null,b=!0):k.__attributes[e]!=h.__attributes[e]?(c[e]=k.__attributes[e],b=!0):k.__attributes[e]==h.__attributes[e]&&delete c[e];return b?c:null};this.getChangedAttributes=t;this.aggregate=
function(){var b={},c;for(c in k){if(!k.hasOwnProperty(c))return;"$"==c[0]&&(b[c.substring(1)]=k[c])}if(0===arguments.length)return b;if(1==arguments.length)return b[arguments[0]];throw Error(".aggregates() called with an incorrect number of arguments. 0, and 1 are supported.");};this.tags=function(){return k.__tags?k.__tags:[]};this.addTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;k.__tags||(k.__tags=[]);k.__tags.push(b);k.__tags=Array.distinct(k.__tags);if(!m||!m.length)return this;
b=m.indexOf(b);-1!=b&&m.splice(b,1);return this};this.removeTag=function(b){if(!b||!_type.isString(b)||!b.length)return this;m.push(b);m=Array.distinct(m);if(!k.__tags||!k.__tags.length)return this;b=k.__tags.indexOf(b);-1!=b&&k.__tags.splice(b,1);return this};var v=function(){if(!k.__tags)return[];if(!h.__tags)return k.__tags;var b=[];k.__tags.forEach(function(c){-1==h.__tags.indexOf(c)&&b.push(c)});return 0<b.length?b:null};this.getChangedTags=v;this.getRemovedTags=function(){return _removetags};
var x=function(b){var c=!1,e=JSON.parse(JSON.stringify(h)),g;for(g in k)null==k[g]||void 0==k[g]?(e[g]=null,c=!0):k[g]!=h[g]?"__tags"==g||"__attributes"==g?delete e[g]:(e[g]=k[g],c=!0):k[g]==h[g]&&delete e[g];try{q.forEach(function(b){e[b]&&delete e[b]})}catch(f){}g=v();b?(g&&(e.__addtags=g,c=!0),m&&0<m.length&&(e.__removetags=m,c=!0)):g&&(e.__addtags=g,c=!0);(b=t())?(e.__attributes=b,c=!0):delete e.__attributes;for(var l in e)"$"==l[0]&&delete e[l];return c&&!Object.isEmpty(e)?e:!1};this.changed=
function(){return x()};this.hasChanged=function(){var b=x(!0);return 0===arguments.length?Object.isEmpty(b)?!1:!0:1==arguments.length&&_type.isString(arguments[0])&&0<arguments[0].length&&b&&b[arguments[0]]?!0:!1};this.changedAttributes=function(){var b=x(!0);if(0===arguments.length)return b;if(1==arguments.length&&_type.isArray(arguments[0])&&arguments[0].length){var c={};arguments[0].forEach(function(e){b[e]&&c.push(b[e])});return c}return!1};this.previous=function(){return 1==arguments.length&&
_type.isString(arguments[0])&&arguments[0].length?h[arguments[0]]:null};this.previousAttributes=function(){return h};this.fields=function(){if(1==arguments.length){var b=arguments[0];_type.isString(b)?n=b:_type.isArray(b)&&(n=b.join(","));return this}return n};var w={integer:function(b){if(b){var c=parseInt(b);if(!isNaN(c))return c}return b},decimal:function(b){if(b){var c=parseFloat(b);if(!isNaN(c))return c}return b},"boolean":function(b){return void 0!==b&&null!==b&&("true"===b.toString().toLowerCase()||
!0===b||0<b)?!0:!1},date:function(b){if(b){var e=c.Appacitive.Date.parseISODate(b);if(e)return e}return b},datetime:function(b){if(b){var e=c.Appacitive.Date.parseISODate(b);if(e)return e}return b},time:function(b){if(b){var e=c.Appacitive.Date.parseISOTime(b);if(e)return e}return b},string:function(b){return b?b.toString():b}};this.get=function(b,c){if(b){if(c&&w[c.toLowerCase()]){if(w[c.toLowerCase()])return w[c.toLowerCase()](k[b]);throw Error('Invalid cast-type "'+c+'"" provided for get "'+b+
'"');}return k[b]}};this.tryGet=function(b,c,e){b=this.get(b,e);return void 0!==b?b:c};this.set=function(b,e){if(!b||!_type.isString(b)||0===b.length||0===b.trim().indexOf("$"))return this;if(void 0==e||null==e)k[b]=null;else if(_type.isString(e))k[b]=e;else if(_type.isNumber(e)||_type.isBoolean(e))k[b]=e+"";else if(e instanceof Date)k[b]=c.Appacitive.Date.toISOString(e);else if(_type.isObject(e))if(-1!==r.indexOf(b))k[b]=e;else if(e instanceof c.Appacitive.GeoCoord)k[b]=e.toString();else throw Error("Property cannot have value as an object");
else _type.isArray(e)&&(k[b]=[],e.forEach(function(e){if(_type.isString(e))k[b].push(e);else if(_type.isNumber(e)||_type.isBoolean(e))k[b].push(e+"");else if(e instanceof Date)k[b].push(c.Appacitive.Date.toISOString(e));else throw Error("Multivalued property cannot have values of property as an object");}),"tags"!==b||"__link"!==b)&&(k[b].push=function(b){var e=this.length;if(_type.isString(b))this[e]=b;else if(_type.isNumber(b)||_type.isBoolean(b))this[e]=b+"";else if(b instanceof Date)this[e]=c.Appacitive.Date.toISOString(b);
else throw Error("Multivalued property cannot have values of property as an object");return this});return this};this.unset=function(b){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;try{delete k[b]}catch(c){}return this};this.has=function(b){return b&&_type.isString(b)&&0!==b.length?k[b]&&!_type.isUndefined(k[b])?!0:!1:!1};this.isNew=function(){return k.__id&&k.__id.length?!1:!0};this.clone=function(){return"article"==this.type?new c.Appacitive.Article(this.toJSON()):new c.Appacitive.connection(k)};
this.copy=function(b,c){b&&(e(b,k),c&&e(b,h));return this};this.mergeWithPrevious=function(){e(k,h);m=[];p.length=0;return this};var y=function(){e(h,k);m=[];p.length=0};this.rollback=function(){k=l={};y();return this};var A=function(b,c,e){if(!b||!_type.isString(b)||0===b.length||0===b.indexOf("__"))return this;c=!c||isNaN(parseInt(c))?e:parseInt(c)*e;p.push({key:b.toLowerCase(),amount:c});return g};this.increment=function(b,c){return A(b,c,1)};this.decrement=function(b,c){return A(b,c,-1)};this.save=
function(){return k.__id?z.apply(this,arguments):B.apply(this,arguments)};var B=function(b){var e=g.type;!k.__schematype||"user"!=k.__schematype.toLowerCase()&&"device"!=k.__schematype.toLowerCase()||(e=k.__schematype.toLowerCase());for(var f in k)"$"==f[0]&&delete k[f];k.__revision&&delete k.__revision;var l=new c.Appacitive._Request({method:"PUT",type:e,op:"getCreateUrl",args:[k.__schematype||k.__relationtype,n],data:k,callbacks:b,entity:g,onSuccess:function(b){var e=null;b&&(b.article||b.connection||
b.user||b.device)&&(e=b.article||b.connection||b.user||b.device);b&&e?(h=e,k.__id=e.__id,y(),"connection"==g.type&&g.parseConnection(),c.Appacitive.eventManager.fire((g.schema||g.relation)+"."+g.type+".created",g,{object:g}),g.created=!0,l.promise.fulfill(g)):(c.Appacitive.eventManager.fire((g.schema||g.relation)+"."+g.type+".createFailed",g,{error:b.status}),l.promise.reject(b.status,g))}});return l.send()},z=function(b,e){c.Appacitive.Promise.is(e)||(e=c.Appacitive.Promise.buildPromise(b));var f=
function(f){var l=x(!0),m;for(m in l)"$"==m[0]&&delete l[m];if(Object.isEmpty(l))e.fulfill(g);else{m=n;var q=new c.Appacitive.HttpRequest,r=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[g.type].getUpdateUrl(k.__schematype||k.__relationtype,h.__id?h.__id:k.__id,m,f),t=g.type;k&&(k.__schematype&&("user"==k.__schematype.toLowerCase()||"device"==k.__schematype.toLowerCase()))&&(t=k.__schematype.toLowerCase(),r=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory[k.__schematype.toLowerCase()].getUpdateUrl(h.__id,
m,f));q.url=r;q.method="post";q.data=l;q.onSuccess=function(f){f&&f[t]?(h=f[t],y(),delete g.created,c.Appacitive.eventManager.fire((g.schema||g.relation)+"."+t+"."+k.__id+".updated",g,{object:g}),e.fulfill(g)):"14008"==f.status.code&&0<p.length?z(b,e):(c.Appacitive.eventManager.fire((g.schema||g.relation)+"."+t+"."+k.__id+".updateFailed",g,{object:f.status}),e.reject(f.status,g))};q.onError=function(c){c=u(c);"14008"==c.code&&0<p.length?z(b,e):e.reject(c,g)};c.Appacitive.http.send(q)}};if(0<p.length){var l=
["__revision"];p.forEach(function(b){l.push(b.key)});c.Appacitive.Article.get({schema:this.get("__schematype"),id:this.id(),fields:l}).then(function(b){b=b.toJSON();p.forEach(function(c){var e=w.integer(b[c.key]);e||(e=0);g.set(c.key,e+c.amount)});f(b.__revision)},function(b){e.reject(b)})}else f();return e},C=function(b){if(!k.__id)throw Error("Please specify id for get operation");var f=this.type;k&&(k.__schematype&&("user"==k.__schematype.toLowerCase()||"device"==k.__schematype.toLowerCase()))&&
(f=k.__schematype.toLowerCase());var l=new c.Appacitive._Request({method:"GET",type:f,op:"getGetUrl",args:[k.__schematype||k.__relationtype,k.__id,n],callbacks:b,entity:g,onSuccess:function(b){b&&b[f]?(h=b[f],e(h,k),b.connection&&(g.endpoints||g.endpointA&&g.endpointB||g.setupConnection(k.__endpointa,k.__endpointb)),l.promise.fulfill(g)):(b=b||{},b.status=b.status||{},b.status=u(b.status),l.promise.reject(b.status,g))}});return l.send()};this.fetch=function(b){return C.apply(this,[b])};this.del=this.destroy=
function(b,e){_type.isBoolean(b)?(e=b,b=null):_type.isBoolean(e)||(e=!1);if(!k.__id)return(new c.Appacitive.Promise.buildPromise(b)).fulfill();var g=this.type;!k.__schematype||"user"!=k.__schematype.toLowerCase()&&"device"!=k.__schematype.toLowerCase()||(g=k.__schematype.toLowerCase());var f=new c.Appacitive._Request({method:"DELETE",type:g,op:"getDeleteUrl",args:[k.__schematype||k.__relationtype,k.__id,e],callbacks:b,entity:this,onSuccess:function(b){f.promise.fulfill(b)}});return f.send()}};c.Appacitive.BaseObject.prototype.toString=
function(){return JSON.stringify(this.getObject())}})(global);
(function(c){var f=function(){return Math.floor(65536*Math.random()).toString(16)};c.Appacitive.GUID=function(){var b=f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f(),c="",e,g,l,k,p,m,n=0,b=b.replace(/\r\n/g,"\n");g="";for(l=0;l<b.length;l++)k=b.charCodeAt(l),128>k?g+=String.fromCharCode(k):(127<k&&2048>k?g+=String.fromCharCode(k>>6|192):(g+=String.fromCharCode(k>>12|224),g+=String.fromCharCode(k>>6&63|128)),g+=String.fromCharCode(k&63|128));for(b=g;n<b.length;)e=b.charCodeAt(n++),g=b.charCodeAt(n++),
l=b.charCodeAt(n++),k=e>>2,e=(e&3)<<4|g>>4,p=(g&15)<<2|l>>6,m=l&63,isNaN(g)?p=m=64:isNaN(l)&&(m=64),c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m);return c.toString()}})(global);
(function(c){c.Appacitive.Article=function(b,f){b=b||{};_type.isString(b)&&(b={__schematype:b});if(!b.__schematype&&!b.schema)throw Error("Cannot set article without __schematype");b.schema&&(b.__schematype=b.schema,delete b.schema);c.Appacitive.BaseObject.call(this,b,f);this.type="article";this.getArticle=this.getObject;this.children={};this.toJSON=function(b){if(b){var c=function(b){var e=[];b.forEach(function(b){var f=b.getObject();if(b.children&&!Object.isEmpty(b.children)){f.children={};for(var h in b.children)f.children[h]=
c(b.children[h])}b.connection&&(f.__connection=b.connection.toJSON());e.push(f)});return e};return c([this])[0]}return this.getObject()};return this};c.Appacitive.Article.prototype=new c.Appacitive.BaseObject;c.Appacitive.Article.prototype.constructor=c.Appacitive.Article;var f=function(b){var f=[];b.forEach(function(b){f.push(new c.Appacitive.Article(b,!0))});return f};c.Appacitive._parseArticles=f;c.Appacitive.Article.multiDelete=function(b,f){b=b||{};if(!b.schema||!_type.isString(b.schema)||0===
b.schema.length)throw Error("Specify valid schema");if("user"===b.schema.toLowerCase()||"device"===b.schema.toLowerCase())throw Error("Cannot delete user and devices using multidelete");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var e=new c.Appacitive._Request({method:"POST",data:{idlist:b.ids},type:"article",op:"getMultiDeleteUrl",args:[b.schema],callbacks:f,onSuccess:function(b){e.promise.fulfill()}});return e.send()};c.Appacitive.Article.multiGet=function(b,h){b=b||{};if(!b.schema||
!_type.isString(b.schema)||0===b.schema.length)throw Error("Specify valid schema");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var e=new c.Appacitive._Request({method:"GET",type:"article",op:"getMultiGetUrl",args:[b.schema,b.ids.join(","),b.fields],callbacks:h,onSuccess:function(b){e.promise.fulfill(f(b.articles))}});return e.send()};c.Appacitive.Article.get=function(b,f){b=b||{};if(!b.schema)throw Error("Specify schema");if(!b.id)throw Error("Specify id to fetch");var e={},e=
"user"===b.schema.toLowerCase()?new c.Appacitive.User({__id:b.id}):new c.Appacitive.Article({__schematype:b.schema,__id:b.id});e.fields=b.fields;return e.fetch(f)};c.Appacitive.Article.prototype.getConnections=function(b){if(this.isNew())throw Error("Cannot fetch connections for new article");b.articleId=this.get("__id");return new c.Appacitive.Queries.GetConnectionsQuery(b)};c.Appacitive.Article.prototype.getConnectedArticles=function(b){if(this.isNew())throw Error("Cannot fetch connections for new article");
b=b||{};_type.isString(b)&&(b={relation:b});b.schema=this.entityType;b.articleId=this.get("__id");b.article=this;return new c.Appacitive.Queries.ConnectedArticlesQuery(b)};c.Appacitive.Article.prototype.fetchConnectedArticles=c.Appacitive.Article.prototype.getConnectedArticles;c.Appacitive.Article.findAll=function(b){return new c.Appacitive.Queries.FindAllQuery(b)}})(global);
(function(c){var f=function(b,g,f){var h={label:b.label};b.articleid&&(h.articleid=b.articleid);if(b.article)_type.isFunction(b.article.getArticle)?b.article.get("__id")?h.articleid=b.article.get("__id"):h.article=b.article.getArticle():_type.isObject(b.article)&&(b.article.__id?h.articleid=b.article.__id:h.article=b.article,b.article=new c.Appacitive.Article(b.article));else if(!h.articleid&&!h.article)throw Error("Incorrectly configured endpoints provided to setupConnection");f["endpoint"+g]=b;
return h},b=function(b,g,f){b.article&&_type.isObject(b.article)?(f["endpoint"+g]?f["endpoint"+g]&&f["endpoint"+g].article&&f["endpoint"+g].article instanceof c.Appacitive.Article?f["endpoint"+g].article.copy(b.article,!0):f["endpoint"+g].article=new c.Appacitive.Article(b.article,!0):(f["endpoint"+g]={},f["endpoint"+g].article=new c.Appacitive.Article(b.article,!0)),f["endpoint"+g].articleid=b.article.__id,f["endpoint"+g].label=b.label,f["endpoint"+g].type=b.type):f["endpoint"+g]=b};c.Appacitive.Connection=
function(e,g){e=e||{};_type.isString(e)&&(e={__relationtype:e});if(!e.__relationtype&&!e.relation)throw Error("Cannot set connection without relation");e.relation&&(e.__relationtype=e.relation,delete e.relation);e.endpoints&&2===e.endpoints.length&&(e.__endpointa=e.endpoints[0],e.__endpointb=e.endpoints[1],delete e.endpoints);c.Appacitive.BaseObject.call(this,e,g);this.type="connection";this.getConnection=this.getObject;this.parseConnection=function(){var c="A",g="B";e.__endpointa.label.toLowerCase()!==
this.get("__endpointb").label.toLowerCase()||(e.__endpointa.label.toLowerCase()==e.__endpointb.label.toLowerCase()||e.__endpointa.articleid!=this.get("__endpointb").articleid&&e.__endpointa.articleid)||(c="B",g="A");b(this.get("__endpointa"),c,this);b(this.get("__endpointb"),g,this);this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;
throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);return b};return this};g?this.parseConnection(e):e.__endpointa&&e.__endpointb&&this.setupConnection(this.get("__endpointa"),this.get("__endpointb"));return this};c.Appacitive.Connection.prototype=new c.Appacitive.BaseObject;c.Appacitive.Connection.prototype.constructor=c.Appacitive.Connection;c.Appacitive.Connection.prototype.setupConnection=function(b,c){if(!(b&&(b.articleid||b.article)&&b.label&&c&&(c.articleid||
c.article)&&c.label))throw Error("Incorrect endpoints configuration passed.");this.set("__endpointa",f(b,"A",this));this.set("__endpointb",f(c,"B",this));this.endpoints=function(){if(1===arguments.length&&_type.isString(arguments[0])){if(this.endpointA.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointA;if(this.endpointB.label.toLowerCase()===arguments[0].toLowerCase())return this.endpointB;throw Error("Invalid label provided");}var b=[];b.push(this.endpointA);b.push(this.endpointB);
return b}};c.Appacitive.Connection.get=function(b,g){b=b||{};if(!b.relation)throw Error("Specify relation");if(!b.id)throw Error("Specify id to fetch");var f=new c.Appacitive.Connection({__relationtype:b.relation,__id:b.id});f.fields=b.fields;return f.fetch(g)};var h=function(b){var g=[];b||(b=[]);b.forEach(function(b){g.push(new c.Appacitive.Connection(b,!0))});return g};c.Appacitive.Connection._parseConnections=h;c.Appacitive.Connection.multiGet=function(b,g){b=b||{};if(!b.relation||!_type.isString(b.relation)||
0===b.relation.length)throw Error("Specify valid relation");if(!b.ids||0===b.ids.length)throw Error("Specify ids to delete");var f=new c.Appacitive._Request({method:"GET",type:"connection",op:"getMultiGetUrl",args:[b.relation,b.ids.join(","),b.fields],callbacks:g,onSuccess:function(b){f.promise.fulfill(h(b.connections))}});return f.send()};c.Appacitive.Connection.multiDelete=function(b,g){b=b||{};if(!b.relation||!_type.isString(b.relation)||0===b.relation.length)throw Error("Specify valid relation");
if(!b.ids||0===b.ids.length)throw Error("Specify ids to get");var f=new c.Appacitive._Request({method:"POST",data:{idlist:b.ids},type:"connection",op:"getMultiDeleteUrl",args:[b.relation],callbacks:g,onSuccess:function(b){f.promise.fulfill()}});return f.send()};c.Appacitive.Connection.findAll=function(b){return new c.Appacitive.Queries.FindAllQuery(b)};c.Appacitive.Connection.getInterconnects=function(b){return new c.Appacitive.Queries.InterconnectsQuery(b)};c.Appacitive.Connection.getBetweenArticles=
function(b){return new c.Appacitive.Queries.GetConnectionsBetweenArticlesQuery(b)};c.Appacitive.Connection.getBetweenArticlesForRelation=function(b){return new c.Appacitive.Queries.GetConnectionsBetweenArticlesForRelationQuery(b)}})(global);
(function(c){c.Appacitive.Users=new function(){var f=null;this.currentUser=this.current=function(){return f};var b=function(b,e,f){var h=this.get("__id");if(!h||!_type.isString(h)||0===h.length)throw Error("Please specify valid userid");if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid oldPassword");if(!e||!_type.isString(e)||0===e.length)throw Error("Please specify valid newPassword");var m=new c.Appacitive._Request({method:"POST",type:"user",op:"getUpdatePasswordUrl",args:[h],
callbacks:f,data:{oldpassword:b,newpassword:e},entity:this,onSuccess:function(b){m.promise.fulfill(that)}});return m.send()},h=function(b,e){var f=this.get("__id");if(!this.get("__id"))return this.set("__link",b),c.Appacitive.Promise.buildPromise(e).fulfill(this);var h=this,m=new c.Appacitive._Request({method:"POST",type:"user",op:"getLinkAccountUrl",args:[f],callbacks:e,data:b,entity:this,onSuccess:function(c){c=h.get("__link");_type.isArray(c)||(c=c?[c]:[]);c.push(b);h.copy({__link:c},!0);m.promise.fulfill(h)}});
return m.send()};this.setCurrentUser=function(e,h,k){if(!e)throw Error("Cannot set null object as user");var p=e;if(p instanceof c.Appacitive.User)if(p.get("__id")&&0!==p.get("__id").length)e=p.toJSON();else throw Error("Specify user __id");else p=new c.Appacitive.User(e,!0);c.Appacitive.localStorage.set("Appacitive-User",e);k||(k=60);f=p;h&&c.Appacitive.Session.setUserAuthHeader(h,k);f.logout=function(b){return c.Appacitive.Users.logout(b)};f.updatePassword=function(c,e,g){return b.apply(this,[c,
e,g])};f.logout=function(b){return c.Appacitive.Users.logout(b)};c.Appacitive.eventManager.clearAndSubscribe("user.article."+p.get("__id")+".updated",function(b,e){c.Appacitive.localStorage.set("Appacitive-User",e.object.getArticle())});return f};c.Appacitive.User=function(b){b=b||{};b.__schematype="user";c.Appacitive.Article.call(this,b);return this};c.Appacitive.User.prototype=new c.Appacitive.Article("user");c.Appacitive.User.prototype.constructor=c.Appacitive.User;c.Appacitive.User.prototype.linkedAccounts=
function(){var b=this.get("__link");b?_type.isArray(b)||(b=[b]):b=[];return b};c.Appacitive.User.prototype.getAllLinkedAccounts=function(b){var e=this.get("__id");if(!e||!_type.isString(e)||0===e.length)return c.Appacitive.Promise.buildPromise(b).fulfill(this.linkedAccounts(),this);var f=this,h=new c.Appacitive._Request({method:"GET",type:"user",op:"getGetAllLinkedAccountsUrl",args:[e],callbacks:b,entity:this,onSuccess:function(){var b=a.identities||[];0<b.length?f.set("__link",b):f.set("__link",
null);h.promise.fulfill(b,f)}});return h.send()};c.Appacitive.User.prototype.checkin=function(b,e){var f=this.get("__id");f&&_type.isString(f)&&0!==f.length||onSuccess&&_type.isFunction(onSuccess)&&onSuccess();if(!(b&&b instanceof c.Appacitive.GeoCoord))throw Error("Invalid coordinates provided");var h=this,m=new c.Appacitive._Request({method:"POST",type:"user",op:"getCheckinUrl",args:[f,b.lat,b.lngerId],callbacks:e,entity:this,onSuccess:function(){m.promise.fulfill(h)}});return m.send()};c.Appacitive.User.prototype.linkFacebook=
function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return h.apply(this,[{authtype:"facebook",accesstoken:b,name:"facebook"},c])};c.Appacitive.User.prototype.linkTwitter=function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e={authtype:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=
b.consumerKey);return h.apply(this,[e,c])};c.Appacitive.User.prototype.unlink=function(b,e){if(!_.isString(b))throw Error("Specify aouth account type for unlinking");var f=this.get("__id");if(!this.get("__id"))return this.set("__link",null),promise.fulfill(this),promise;var h=this,m=new c.Appacitive._Request({method:"POST",type:"user",op:"getDelinkAccountUrl",args:[f,b],callbacks:e,entity:this,onSuccess:function(c){(c=h.get("__link"))?_type.isArray(c)||(c=[c]):c=[];if(0<=c.length){var e=null;c.forEach(function(c,
f){c.name==b.toLowerCase()&&(e=f)});null!=e&&c.splice(e,1);h.copy({__link:c},!0)}else h.copy({__link:[]},!0);m.promise.fulfill(h)}});return m.send()};c.Appacitive.User.prototype.clone=function(){return new c.Appacitive.User(this.getObject())};this.deleteUser=function(b,e){if(!b)throw Error("Specify userid for user delete");return(new c.Appacitive.Article({__schematype:"user",__id:b})).del(!0,e)};this.deleteCurrentUser=function(b){var e=c.Appacitive.Promise.buildPromise(b);if(null===f)return c.Appacitive.Session.removeUserAuthHeader(),
e.fulfill(),e;b=f.get("__id");this.deleteUser(b).then(function(){f=null;c.Appacitive.Session.removeUserAuthHeader();e.fulfill()},function(){e.reject(arguments)});return e};this.createUser=this.createNewUser=function(b,e){b=b||{};b.__schematype="user";if(!b.username||!b.password||!b.firstname||0===b.username.length||0===b.password.length||0===b.firstname.length)throw Error("username, password and firstname are mandatory");return(new c.Appacitive.User(b)).save(e)};this.signup=function(b,e){var f=this,
h=c.Appacitive.Promise.buildPromise(e);this.createUser(b).then(function(){f.login(b.username,b.password).then(function(){h.fulfill.apply(h,arguments)},function(b){h.reject.apply(h,arguments)})},function(){h.reject(arguments)});return h};this.authenticateUser=function(b,e,h){b.expiry||(b.expiry=864E5);var p=this,m=new c.Appacitive._Request({method:"POST",type:"user",op:"getAuthenticateUserUrl",callbacks:e,data:b,onSuccess:function(c){c&&c.user?(h&&(c.user.__authType=h),p.setCurrentUser(c.user,c.token,
b.expiry),m.promise.fulfill({user:f,token:c.token})):m.promise.reject(c.status)}});return m.send()};this.login=function(b,c,e){if(!b||!c||0==b.length||0==c.length)throw Error("Please specify username and password");return this.authenticateUser({username:b,password:c,expiry:864E5},e,"BASIC")};this.loginWithFacebook=function(b,c){if(!b||!_type.isString(b))throw Error("Please provide accessToken");return this.authenticateUser({accesstoken:b,type:"facebook",expiry:864E5,createnew:!0},c,"FB")};this.loginWithTwitter=
function(b,c){if(!_type.isObject(b)||!b.oAuthToken||!b.oAuthTokenSecret)throw Error("Twitter Token and Token Secret required for linking");var e={type:"twitter",oauthtoken:b.oAuthToken,oauthtokensecret:b.oAuthTokenSecret,expiry:864E5,createnew:!0};b.consumerKey&&b.consumerSecret&&(e.consumersecret=b.consumerSecret,e.consumerkey=b.consumerKey);return this.authenticateUser(e,c,"TWITTER")};this.validateCurrentUser=function(b,e){var f=c.Appacitive.Promise.buildPromise({success:e});e&&_type.isBoolean(e)&&
(b=e,e=function(){});var h=c.Appacitive.Cookie.readCookie("Appacitive-UserToken");if(!h)return f.fulfill(!1),f;if(b)f.fulfill(!0);else try{var m=this;this.getUserByToken(h).then(function(b){m.setCurrentUser(b,h);f.fulfill(!0)},function(){f.fulfill(!1)})}catch(n){f.fulfill(!1)}return f};var e=function(b,e,f){var h=new c.Appacitive._Request({method:"GET",type:"user",op:b,callbacks:f,args:e,onSuccess:function(b){b&&b.user?h.promise.fulfill(new c.Appacitive.User(b.user)):h.promise.reject(b.status)}});
return h.send()};this.getUserByToken=function(b,f){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid token");c.Appacitive.Session.setUserAuthHeader(b,0,!0);return e("getUserByTokenUrl",[b],f)};this.getUserByUsername=function(b,c){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");return e("getUserByUsernameUrl",[b],c)};this.logout=function(b){f=null;return c.Appacitive.Session.removeUserAuthHeader(b)};this.sendResetPasswordEmail=function(b,
e,f){if(!b||!_type.isString(b)||0===b.length)throw Error("Please specify valid username");if(!e||!_type.isString(e)||0===e.length)throw Error("Plase specify subject for email");var h=new c.Appacitive._Request({method:"POST",type:"user",op:"getSendResetPasswordEmailUrl",callbacks:f,data:{username:b,subject:e},onSuccess:function(){h.promise.fulfill()}});return h.send()};this.resetPassword=function(b,e,f){if(!b)throw Error("Please specify token");if(!e||0===e.length)throw Error("Please specify password");
var h=new c.Appacitive._Request({method:"POST",type:"user",op:"getResetPasswordUrl",callbacks:f,data:{newpassword:e},args:[b],onSuccess:function(){h.promise.fulfill()}});return h.send()};this.validateResetPasswordToken=function(b,e){if(!b)throw Error("Please specify token");var f=new c.Appacitive._Request({method:"POST",type:"user",op:"getValidateResetPasswordUrl",callbacks:e,data:{},args:[b],onSuccess:function(b){f.promise.fulfill(b.user)}});return f.send()}}})(global);
(function(c){var f=function(){var b=null,f=this.FB=null,e=!1;this.initialize=function(b){if(!Facebook)throw Error("node-facebook SDK needs be loaded before calling initialize.");if(!b.appId)throw Error("Please provide appid");if(!b.appSecret)throw Error("Please provide app secret");f=b.appSecret;this.FB=new (require("facebook-node-sdk"))({appId:_appId,secret:f});e=!0};this.requestLogin=function(c){c&&(b=c);return(new Appacitive.Promise).fulfill()};this.getCurrentUserInfo=function(){if(!e)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");
var c=new Appacitive.Promise;this.FB&&b?this.FB.api("/me",function(b,e){e?c.fulfill(e):c.reject("Access token is invalid")}):c.reject("Either intialize facebook with your appid and appsecret or set accesstoken");return c};this.accessToken=function(){return 1===arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){c.Appacitive.Facebook.accessToken="";return(new Appacitive.Promise).fulfill()}};c.Appacitive.Facebook=
c.Appacitive.runtime.isBrowser?new function(){var b=null,f=!0;this.initialize=function(b){if(!FB)throw"Facebook SDK needs be loaded before calling initialize.";if(!b.appId)throw Error("Please provide appid");FB.init(b);f=!0};this.requestLogin=function(c){c=c||{};if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var g=new Appacitive.Promise;FB.login(function(c){c&&"connected"===c.status&&c.authResponse?(b=c.authResponse.accessToken,g.fulfill(c.authResponse)):
g.reject()},c);return g};this.getCurrentUserInfo=function(){if(!f)throw Error("Either facebook sdk has not yet been initialized, or not yet loaded.");var c=new Appacitive.Promise;FB.api("/me",function(f){f&&!f.error?(b=FB.getAuthResponse().accessToken,c.fulfill(f)):c.reject()});return c};this.accessToken=function(){return 1===arguments.length?(b=arguments[0],this):b};this.getProfilePictureUrl=function(b){return"https://graph.facebook.com/"+b+"/picture"};this.logout=function(){b=null;var e=new Appacitive.Promise;
try{FB.logout(function(){c.Appacitive.Users.logout();e.fulfill()})}catch(f){e.reject(f.message)}return e}}:new f})(global);
(function(c){c.Appacitive.Email=new function(){var f={smtp:{username:null,password:null,host:"smtp.gmail.com",port:465,enablessl:!0},from:null,replyto:null};this.getConfig=function(){return f};var b=function(b,e){var f=new c.Appacitive._Request({method:"POST",type:"email",op:"getSendEmailUrl",callbacks:e,data:b,entity:b,onSuccess:function(b){f.promise.fulfill(b.email)}});return f.send()};this.setupEmail=function(b){b=b||{};f.smtp.username=b.username||f.smtp.username;f.from=b.from||f.from;f.smtp.password=
b.password||f.smtp.password;f.smtp.host=b.smtp.host||f.smtp.host;f.smtp.port=b.smtp.port||f.smtp.port;f.smtp.enablessl=b.enableSSL||f.smtp.enablessl;f.replyto=b.replyTo||f.replyto};this.sendTemplatedEmail=function(c,e){if(!c||!c.to||!c.to.length||0===c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0===c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");
if(!c.templateName)throw Error("template name is mandatory to send an email");var g={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,from:c.from,body:{templatename:c.templateName||"",data:c.data||{},ishtml:!1===c.isHtml?!1:!0}};if(c.useConfig){g.smtp=f.smtp;if(!c.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=c.from||f.from;g.replyto=c.replyTo||f.replyto}return b(g,e)};this.sendRawEmail=function(c,e){if(!c||!c.to||!c.to.length||
0===c.to.length)throw Error("Atleast one receipient is mandatory to send an email");if(!c.subject||0===c.subject.trim().length)throw Error("Subject is mandatory to send an email");if(!c.from&&f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options on the portal");if(!c.body)throw Error("body is mandatory to send an email");var g={to:c.to||[],cc:c.cc||[],bcc:c.bcc||[],subject:c.subject,from:c.from,body:{content:c.body||"",ishtml:!1===c.isHtml?!1:!0}};if(c.useConfig){g.smtp=
f.smtp;if(!c.from&&!f.from)throw Error("from is mandatory to send an email. Set it in config or send it in options");g.from=c.from||f.from;g.replyto=c.replyTo||f.replyto}return b(g,e)}}})(global);
(function(c){c.Appacitive.Push=new function(){this.send=function(f,b){if(!f)throw Error("Please specify push options");var h=new c.Appacitive._Request({method:"POST",type:"push",op:"getPushUrl",callbacks:b,data:f,entity:f,onSuccess:function(b){h.promise.fulfill(b.id)}});return h.send()};this.getNotification=function(f,b){if(!f)throw Error("Please specify notification id");var h=new c.Appacitive._Request({method:"GET",type:"push",op:"getGetNotificationUrl",args:[f],callbacks:b,onSuccess:function(b){h.promise.fulfill(b.pushnotification)}});
return h.send()};this.getAllNotifications=function(f,b){f?(f.pnum=f.pnum||1,f.psize=f.psize||20):f={pnum:1,psize:20};var h=new c.Appacitive._Request({method:"GET",type:"push",op:"getGetAllNotificationsUrl",args:[f],callbacks:b,onSuccess:function(b){h.promise.fulfill(b.pushnotifications,b.paginginfo)}});return h.send()}}})(global);
(function(c){c.Appacitive.File=function(f){f=f||{};this.fileId=f.fileId;this.contentType=f.contentType;this.fileData=f.fileData;var b=this,h=function(e,f,g){var h=new c.Appacitive.HttpRequest;h.url=e;h.method="GET";h.onSuccess=f;h.promise=g;h.entity=b;c.Appacitive.http.send(h)},e=function(e,f,g,h,l){(new FormData).append("fileToUpload",f);var r=new c.Appacitive.HttpRequest;r.url=e;r.method="PUT";r.data=f;r.headers.push({key:"content-type",value:g});r.onSuccess=h;r.send().then(h,function(){l.reject(d,
b)})};this.save=function(b){return this.fileId&&_type.isString(this.fileId)&&0<this.fileId.length?l(b):g(b)};var g=function(f){if(!b.fileData)throw Error("Please specify filedata");b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");try{b.contentType=file.type}catch(g){}var l=c.Appacitive.Promise.buildPromise(f);f=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUploadUrl(b.contentType,b.fileId?b.fileId:"");h(f,function(c){e(c.url,
b.fileData,b.contentType,function(){b.fileId=c.id;b.getDownloadUrl(function(c){return l.fulfill(c,b)},function(b){return l.reject(b)})},l)},l);return l},l=function(f){if(!b.fileData)throw Error("Please specify filedata");b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");try{b.contentType=file.type}catch(g){}var l=c.Appacitive.Promise.buildPromise(f);f=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getUpdateUrl(b.fileId,b.contentType);
h(f,function(c){e(c.url,b.fileData,b.contentType,function(){b.getDownloadUrl().then(function(c){l.fulfill(c,b)},function(b){l.reject(b)})},l)},l);return l};this.deleteFile=function(e){if(!this.fileId)throw Error("Please specify fileId to delete");var f=c.Appacitive.Promise.buildPromise(e);e=new c.Appacitive.HttpRequest;e.url=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getDeleteUrl(this.fileId);e.method="DELETE";e.onSuccess=function(b){f.fulfill()};e.promise=f;e.entity=b;return c.Appacitive.http.send(e)};
this.getDownloadUrl=function(e){if(!this.fileId)throw Error("Please specify fileId to download");var f=c.Appacitive.Promise.buildPromise(e);e=c.Appacitive.config.apiBaseUrl+c.Appacitive.storage.urlFactory.file.getDownloadUrl(this.fileId,556E4);h(e,function(c){b.url=c.uri;f.fulfill(c.uri)},f);return f};this.getUploadUrl=function(e){b.contentType&&_type.isString(b.contentType)&&0!==b.contentType.length||(b.contentType="text/plain");var f=c.Appacitive.Promise.buildPromise(e);e=c.Appacitive.config.apiBaseUrl+
c.Appacitive.storage.urlFactory.file.getUploadUrl(this.contentType,this.fileId?this.fileId:"");h(e,function(c){b.url=c.url;f.fulfill(c.url,b)},f);return f}}})(global);
(function(c){c.Appacitive.Date={};var f=function(b){return 10>b?"0"+b:b};c.Appacitive.Date.parseISODate=function(b){try{if(!/^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(b))return new Date(b);var c=b.split("T"),e=c[0].split("-"),f=c[1].split("Z")[0].split(":"),l=f[2].split("."),k=Number(f[0]),p=new Date;p.setUTCFullYear(Number(e[0]));p.setUTCMonth(Number(e[1])-1);p.setUTCDate(Number(e[2]));p.setUTCHours(Number(k));p.setUTCMinutes(Number(f[1]));
p.setUTCSeconds(Number(l[0]));l[1]&&p.setUTCMilliseconds(Number(l[1].substring(0,3)));return p}catch(m){return null}};c.Appacitive.Date.toISOString=function(b){try{return b=b.toISOString(),b=b.replace("Z","0000Z")}catch(c){return null}};c.Appacitive.Date.toISODate=function(b){if(b instanceof Date)return String.format("{0}-{1}-{2}",b.getFullYear(),f(b.getMonth()+1),f(b.getDate()));throw Error("Invalid date provided Appacitive.Date.toISODate method");};c.Appacitive.Date.toISOTime=function(b){var c=
function(b){return 10>b?b+"000000":100>b?b+"00000":1E3>b?b+"0000":1E4>b?b+"000":1E5>b?b+"00":1E6>b?b+"0":b};if(b instanceof Date)return String.format("{0}:{1}:{2}.{3}",f(b.getHours()),f(b.getMinutes()),f(b.getSeconds()),c(b.getMilliseconds()));throw Error("Invalid date provided Appacitive.Date.toISOTime method");};c.Appacitive.Date.parseISOTime=function(b){try{var c=new Date,e=b.split("T");1===e.length&&e.push(e[0]);if(!/^([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z?$/.exec(e[1]))return null;
var f=e[1].split("Z")[0].split(":"),l=f[2].split("."),k=Number(f[0]);1<e.length?(c.setUTCHours(Number(k)),c.setUTCMinutes(Number(f[1])),c.setUTCSeconds(Number(l[0])),l[1]&&c.setUTCMilliseconds(Number(l[1].substring(0,3)))):(c.setHours(Number(k)),c.setMinutes(Number(f[1])),c.setSeconds(Number(l[0])),l[1]&&c.setMilliseconds(Number(l[1].substring(0,3))));return c}catch(p){return null}}})(global);
(function(c){c.Appacitive.localStorage=new (c.Appacitive.runtime.isBrowser?function(){var f=c.Appacitive.runtime.isBrowser?window.localStorage:{getItem:function(){return null}};this.set=function(b,h){h=h||"";if(!b)return!1;if(_type.isObject(h)||_type.isArray(h))try{h=JSON.stringify(h)}catch(e){}b=c.Appacitive.getAppPrefix(b);f[b]=h;return this};this.get=function(b){if(!b)return null;b=c.Appacitive.getAppPrefix(b);b=f.getItem(b);if(!b)return null;if("{"===b[0])try{b=JSON.parse(b)}catch(h){}return b};
this.remove=function(b){if(b){b=c.Appacitive.getAppPrefix(b);try{delete f[b]}catch(h){}}}}:function(){var f=[];this.set=function(b,h){h=h||"";if(!b||_type.isString(b))return!1;b=c.Appacitive.getAppPrefix(b);f[b]=h;return this};this.get=function(b){if(!b||_type.isString(b))return null;b=c.Appacitive.getAppPrefix(b);return(b=f[b])?b:null};this.remove=function(b){if(b&&!_type.isString(b)){b=c.Appacitive.getAppPrefix(b);try{delete f[b]}catch(h){}}}})})(global);
(function(c){c.Appacitive.Cookie=new (c.Appacitive.runtime.isBrowser?function(){this.setCookie=function(f,b,h,e){f=c.Appacitive.getAppPrefix(f);var g="";h&&(g=new Date,g.setTime(g.getTime()+6E4*h),g.toGMTString());g=e?"; expires=Thu, 01-Jan-1970 00:00:01 GMT":c.Appacitive.Session.persistUserToken?"; expires="+(new Date("2020-12-31")).toGMTString():"";h="domain="+window.location.hostname;"localhost"==window.location.hostname&&(h="");document.cookie=f+"="+b+g+"; path=/;"+h};this.readCookie=function(f){f=
c.Appacitive.getAppPrefix(f);f+="=";for(var b=document.cookie.split(";"),h=0;h<b.length;h++){for(var e=b[h];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(f))return e.substring(f.length,e.length)}return null};this.eraseCookie=function(c){this.setCookie(c,"",-1,!0)}}:function(){this.setCookie=function(f,b){c.Appacitive.localStorage.set("cookie/"+f,b)};this.readCookie=function(f){return c.Appacitive.localStorage.get("cookie/"+f)};this.eraseCookie=function(f){c.Appacitive.localStorage.remove("cookie/"+
f)}})})(global);"undefined"===typeof module||global.Appacitive.runtime.isBrowser||(module.exports=global.Appacitive);
